<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n - Cr√™pes & Kaffee</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/styles.css?v=2024">
    <link rel="stylesheet" href="assets/css/configuracion.css?v=2024">
</head>
<body>
    <div class="app-container">
        <!    <!-- Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="assets/js/database.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/drive-backup.js"></script>
    <script src="assets/js/configuracion.js"></script>
    
    <script>
        // Funciones para Google Drive
        async function connectGoogleDrive() {
            try {
                document.getElementById('connectDriveBtn').disabled = true;
                document.getElementById('driveStatusText').textContent = 'Estado: Conectando...';
                
                if (!window.driveBackupManager) {
                    window.driveBackupManager = new DriveBackupManager();
                }
                
                const success = await window.driveBackupManager.authenticateWithDrive();
                
                if (success) {
                    document.getElementById('driveStatusText').textContent = 'Estado: ‚úÖ Conectado exitosamente';
                    document.getElementById('testDriveBtn').disabled = false;
                    window.configuracionManager.showNotification('‚úÖ Conectado con Google Drive exitosamente', 'success');
                } else {
                    throw new Error('No se pudo autenticar');
                }
            } catch (error) {
                document.getElementById('driveStatusText').textContent = 'Estado: ‚ùå Error de conexi√≥n';
                window.configuracionManager.showNotification('‚ùå Error conectando con Google Drive: ' + error.message, 'error');
            } finally {
                document.getElementById('connectDriveBtn').disabled = false;
            }
        }
        
        async function testDriveUpload() {
            try {
                document.getElementById('testDriveBtn').disabled = true;
                document.getElementById('driveStatusText').textContent = 'Estado: Probando subida...';
                
                if (!window.driveBackupManager) {
                    throw new Error('Google Drive no est√° configurado');
                }
                
                await window.driveBackupManager.testUpload();
                document.getElementById('driveStatusText').textContent = 'Estado: ‚úÖ Prueba exitosa';
                window.configuracionManager.showNotification('‚úÖ Prueba de subida exitosa', 'success');
            } catch (error) {
                document.getElementById('driveStatusText').textContent = 'Estado: ‚ùå Error en prueba';
                window.configuracionManager.showNotification('‚ùå Error en prueba: ' + error.message, 'error');
            } finally {
                document.getElementById('testDriveBtn').disabled = false;
            }
        }
        
        function saveDriveConfig() {
            try {
                if (!window.driveBackupManager) {
                    window.driveBackupManager = new DriveBackupManager();
                }
                
                const config = {
                    autoUploadToDrive: document.getElementById('autoUploadToDrive').checked,
                    driveFolder: document.getElementById('driveFolder').value,
                    autoUploadSchedule: document.getElementById('autoUploadSchedule').value,
                    maxBackupsInDrive: parseInt(document.getElementById('maxBackupsInDrive').value),
                    lastUpload: window.driveBackupManager.driveConfig.lastUpload
                };
                
                window.driveBackupManager.saveDriveConfig(config);
                window.configuracionManager.showNotification('‚úÖ Configuraci√≥n de Google Drive guardada', 'success');
                
                // Iniciar respaldos programados si est√° habilitado
                if (config.autoUploadToDrive && config.autoUploadSchedule !== 'manual') {
                    window.driveBackupManager.startScheduledBackups();
                }
            } catch (error) {
                window.configuracionManager.showNotification('‚ùå Error guardando configuraci√≥n: ' + error.message, 'error');
            }
        }
        
        // Cargar configuraci√≥n existente al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (window.driveBackupManager && window.driveBackupManager.driveConfig) {
                    const config = window.driveBackupManager.driveConfig;
                    document.getElementById('autoUploadToDrive').checked = config.autoUploadToDrive;
                    document.getElementById('driveFolder').value = config.driveFolder;
                    document.getElementById('autoUploadSchedule').value = config.autoUploadSchedule;
                    document.getElementById('maxBackupsInDrive').value = config.maxBackupsInDrive;
                    
                    if (config.lastUpload) {
                        document.getElementById('driveStatusText').textContent = 
                            `Estado: √öltimo respaldo ${new Date(config.lastUpload).toLocaleString()}`;
                    }
                }
            }, 1000);
        });
    </script>idebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">MEN√ö PRINCIPAL</h1>
                <div class="sidebar-subtitle">Sistema POS</div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </div>
                <div class="nav-item">
                    <a href="ventas.html" class="nav-link">
                        <i class="fas fa-cash-register"></i>
                        Ventas
                    </a>
                </div>
                <div class="nav-item">
                    <a href="pedidos.html" class="nav-link">
                        <i class="fas fa-clipboard-list"></i>
                        Pedidos
                    </a>
                </div>
                <div class="nav-item">
                    <a href="mesas.html" class="nav-link">
                        <i class="fas fa-chair"></i>
                        Mesas
                    </a>
                </div>
                <div class="nav-item">
                    <a href="reportes.html" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        Reportes
                    </a>
                </div>
                <div class="nav-item">
                    <a href="caja.html" class="nav-link">
                        <i class="fas fa-cash-register"></i>
                        Caja
                    </a>
                </div>
                <div class="nav-item">
                    <a href="configuracion.html" class="nav-link active">
                        <i class="fas fa-cog"></i>
                        Configuraci√≥n
                    </a>
                </div>
                <div class="nav-item">
                    <a href="login.html" class="nav-link" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Cerrar Sesi√≥n
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="page-header">
                <h1 class="page-title">Configuraci√≥n del Sistema</h1>
                <p class="page-subtitle">Gestiona las configuraciones del restaurante</p>
            </header>
            
            <div class="page-content">
                <!-- Navegaci√≥n de Configuraci√≥n -->
                <div class="config-nav mb-4">
                    <button class="config-tab active" data-tab="general">
                        <i class="fas fa-cogs"></i>
                        General
                    </button>
                    <button class="config-tab" data-tab="productos">
                        <i class="fas fa-box"></i>
                        Productos
                    </button>
                    <button class="config-tab" data-tab="usuarios">
                        <i class="fas fa-users"></i>
                        Usuarios
                    </button>
                    <button class="config-tab" data-tab="impresoras">
                        <i class="fas fa-print"></i>
                        Impresoras
                    </button>
                    <button class="config-tab" data-tab="backup">
                        <i class="fas fa-database"></i>
                        Respaldos
                    </button>
                </div>

                <!-- Configuraci√≥n General -->
                <div class="config-section active" id="general">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Informaci√≥n del Restaurante</h3>
                        </div>
                        <div class="card-body">
                            <form class="config-form">
                                <div class="grid grid-2">
                                    <div class="form-group">
                                        <label for="restaurantName">Nombre del Restaurante</label>
                                        <input type="text" id="restaurantName" class="form-input" value="Cr√™pes & Kaffee">
                                    </div>
                                    <div class="form-group">
                                        <label for="restaurantPhone">Tel√©fono</label>
                                        <input type="tel" id="restaurantPhone" class="form-input" value="+1 234 567 8900">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="restaurantAddress">Direcci√≥n</label>
                                    <textarea id="restaurantAddress" class="form-textarea" rows="3">Calle Principal 123, Ciudad, Estado 12345</textarea>
                                </div>
                                
                                <div class="grid grid-2">
                                    <div class="form-group">
                                        <label for="currency">Moneda</label>
                                        <select id="currency" class="form-select">
                                            <option value="USD">D√≥lar ($)</option>
                                            <option value="EUR">Euro (‚Ç¨)</option>
                                            <option value="COP">Peso Colombiano ($)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="timezone">Zona Horaria</label>
                                        <select id="timezone" class="form-select">
                                            <option value="UTC-6">M√©xico (UTC-6)</option>
                                            <option value="UTC-5">Colombia (UTC-5)</option>
                                            <option value="UTC-3">Argentina (UTC-3)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Guardar Cambios
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Configuraci√≥n de Operaci√≥n</h3>
                        </div>
                        <div class="card-body">
                            <form class="config-form">
                                <div class="grid grid-2">
                                    <div class="form-group">
                                        <label for="openTime">Hora de Apertura</label>
                                        <input type="time" id="openTime" class="form-input" value="08:00">
                                    </div>
                                    <div class="form-group">
                                        <label for="closeTime">Hora de Cierre</label>
                                        <input type="time" id="closeTime" class="form-input" value="22:00">
                                    </div>
                                </div>
                                
                                <div class="grid grid-1">
                                    <div class="form-group">
                                        <label for="serviceCharge">Cargo por Servicio (%)</label>
                                        <input type="number" id="serviceCharge" class="form-input" value="10" min="0" max="100" step="0.01">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="autoCloseOrders" checked>
                                            <span class="checkmark"></span>
                                            Cerrar pedidos autom√°ticamente despu√©s de 2 horas
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Guardar Configuraci√≥n
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Gesti√≥n de Productos -->
                <div class="config-section" id="productos">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Gesti√≥n de Productos</h3>
                            <button class="btn btn-primary" onclick="showAddProductModal()">
                                <i class="fas fa-plus"></i>
                                Nuevo Producto
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="products-grid" id="productsGrid">
                                <!-- Los productos se cargan din√°micamente -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Categor√≠as</h3>
                            <button class="btn btn-secondary" onclick="showAddCategoryModal()">
                                <i class="fas fa-plus"></i>
                                Nueva Categor√≠a
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="categories-list" id="categoriesList">
                                <!-- Las categor√≠as se cargan din√°micamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gesti√≥n de Usuarios -->
                <div class="config-section" id="usuarios">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Usuarios del Sistema</h3>
                            <button class="btn btn-primary" onclick="showAddUserModal()">
                                <i class="fas fa-user-plus"></i>
                                Nuevo Usuario
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="users-table">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Usuario</th>
                                            <th>Nombre</th>
                                            <th>Rol</th>
                                            <th>Estado</th>
                                            <th>√öltimo Acceso</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        <!-- Los usuarios se cargan din√°micamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuraci√≥n de Impresoras -->
                <div class="config-section" id="impresoras">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Configuraci√≥n de Impresoras</h3>
                            <button class="btn btn-primary" onclick="detectPrinters()">
                                <i class="fas fa-search"></i>
                                Detectar Impresoras
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="printers-config">
                                <div class="printer-item">
                                    <div class="printer-info">
                                        <h4>Impresora de Recibos</h4>
                                        <p>Para tickets de venta</p>
                                    </div>
                                    <div class="printer-controls">
                                        <select class="form-select">
                                            <option>Seleccionar impresora...</option>
                                            <option>Impresora T√©rmica USB</option>
                                            <option>Impresora de Red 192.168.1.100</option>
                                        </select>
                                        <button class="btn btn-secondary" onclick="testPrint('receipts')">
                                            <i class="fas fa-print"></i>
                                            Probar
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="printer-item">
                                    <div class="printer-info">
                                        <h4>Impresora de Cocina</h4>
                                        <p>Para √≥rdenes de cocina</p>
                                    </div>
                                    <div class="printer-controls">
                                        <select class="form-select">
                                            <option>Seleccionar impresora...</option>
                                            <option>Impresora Cocina USB</option>
                                            <option>Impresora de Red 192.168.1.101</option>
                                        </select>
                                        <button class="btn btn-secondary" onclick="testPrint('kitchen')">
                                            <i class="fas fa-print"></i>
                                            Probar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="print-settings">
                                <h4>Configuraci√≥n de Impresi√≥n</h4>
                                <div class="grid grid-2">
                                    <div class="form-group">
                                        <label>Tama√±o de Papel (Recibos)</label>
                                        <select class="form-select">
                                            <option>80mm</option>
                                            <option>58mm</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Copias por Ticket</label>
                                        <input type="number" class="form-input" value="1" min="1" max="5">
                                    </div>
                                </div>
                                
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span class="checkmark"></span>
                                        Imprimir autom√°ticamente en cocina
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox">
                                        <span class="checkmark"></span>
                                        Imprimir recibo autom√°ticamente
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Respaldos y Mantenimiento -->
                <div class="config-section" id="backup">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Respaldos de Datos</h3>
                        </div>
                        <div class="card-body">
                            <div class="backup-actions">
                                <div class="backup-item">
                                    <div class="backup-info">
                                        <h4>Crear Respaldo Completo</h4>
                                        <p>Genera un respaldo completo incluyendo todos los datos: ventas, pedidos, productos, usuarios, mesas, hist√≥rico completo de reportes y an√°lisis</p>
                                    </div>
                                    <button class="btn btn-primary" onclick="createBackup()">
                                        <i class="fas fa-download"></i>
                                        Crear Respaldo Completo
                                    </button>
                                </div>
                                
                                <div class="backup-item">
                                    <div class="backup-info">
                                        <h4>Restaurar Datos Completos</h4>
                                        <p>Restaura todos los datos desde un archivo de respaldo completo incluyendo ventas hist√≥ricas, reportes y an√°lisis</p>
                                    </div>
                                    <div class="backup-controls">
                                        <input type="file" id="restoreFile" accept=".json" style="display: none;">
                                        <button class="btn btn-secondary" onclick="selectRestoreFile()">
                                            <i class="fas fa-upload"></i>
                                            Seleccionar Archivo
                                        </button>
                                        <button class="btn btn-warning" onclick="restoreBackup()" disabled>
                                            <i class="fas fa-upload"></i>
                                            Restaurar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="backup-schedule">
                                <h4>Respaldos Autom√°ticos</h4>
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="autoBackup" checked>
                                            <span class="checkmark"></span>
                                            Crear respaldos autom√°ticos diarios
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Hora del respaldo autom√°tico</label>
                                    <input type="time" class="form-input" value="02:00">
                                </div>
                            </div>
                            
                            <!-- Nueva secci√≥n de Google Drive -->
                            <div class="drive-backup-section">
                                <h4>üåê Respaldos Autom√°ticos a Google Drive</h4>
                                
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="autoUploadToDrive">
                                            <span class="checkmark"></span>
                                            Subir respaldos autom√°ticamente a Google Drive
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Nombre de carpeta en Drive:</label>
                                    <input type="text" id="driveFolder" class="form-input" value="Respaldos_POS_Crepes_Kaffee" placeholder="Nombre de la carpeta en Drive">
                                </div>
                                
                                <div class="form-group">
                                    <label>Frecuencia de respaldos autom√°ticos:</label>
                                    <select id="autoUploadSchedule" class="form-input">
                                        <option value="manual">Solo manual</option>
                                        <option value="daily" selected>Diario</option>
                                        <option value="weekly">Semanal</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>M√°ximo respaldos en Drive:</label>
                                    <input type="number" id="maxBackupsInDrive" class="form-input" value="10" min="1" max="50">
                                    <small>Solo se mantendr√°n los respaldos m√°s recientes</small>
                                </div>
                                
                                <div class="drive-actions" style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button type="button" class="btn btn-secondary" onclick="connectGoogleDrive()" id="connectDriveBtn">
                                        <i class="fas fa-google-drive"></i>
                                        Conectar con Google Drive
                                    </button>
                                    
                                    <button type="button" class="btn btn-success" onclick="testDriveUpload()" id="testDriveBtn" disabled>
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        Probar Subida
                                    </button>
                                    
                                    <button type="button" class="btn btn-info" onclick="saveDriveConfig()">
                                        <i class="fas fa-save"></i>
                                        Guardar Configuraci√≥n
                                    </button>
                                </div>
                                
                                <div id="driveStatus" class="drive-status" style="margin-top: 10px;">
                                    <small id="driveStatusText">Estado: No conectado</small>
                                </div>
                                
                                <div class="drive-help" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 12px;">
                                    <strong>üí° Instrucciones:</strong>
                                    <ol style="margin: 5px 0; padding-left: 20px;">
                                        <li>Haz clic en "Conectar con Google Drive"</li>
                                        <li>Autoriza la aplicaci√≥n en tu cuenta de Google</li>
                                        <li>Configura la frecuencia de respaldos</li>
                                        <li>Haz clic en "Probar Subida" para verificar</li>
                                        <li>Guarda la configuraci√≥n</li>
                                    </ol>
                                    <p style="margin: 5px 0;"><strong>Nota:</strong> Los respaldos se subir√°n autom√°ticamente a Drive cuando crees uno nuevo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Mantenimiento del Sistema</h3>
                        </div>
                        <div class="card-body">
                            <div class="maintenance-actions">
                                <div class="maintenance-item">
                                    <div class="maintenance-info">
                                        <h4>Limpiar Datos Antiguos</h4>
                                        <p>Elimina pedidos y datos antiguos para optimizar el rendimiento</p>
                                    </div>
                                    <button class="btn btn-warning" onclick="window.configuracionManager.cleanOldData()" id="cleanDataBtn">
                                        <i class="fas fa-broom"></i>
                                        Limpiar Datos
                                    </button>
                                </div>
                                
                                <div class="maintenance-item">
                                    <div class="maintenance-info">
                                        <h4>Reiniciar Sistema</h4>
                                        <p>Reinicia la aplicaci√≥n para aplicar cambios pendientes</p>
                                    </div>
                                    <button class="btn btn-danger" onclick="console.log('Bot√≥n presionado'); restartSystem();" id="restartBtn">
                                        <i class="fas fa-power-off"></i>
                                        Reiniciar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Producto -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Nuevo Producto</h3>
                <button class="modal-close" onclick="closeModal('productModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label for="productName">Nombre del Producto</label>
                        <input type="text" id="productName" class="form-input" required>
                    </div>
                    
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="productPrice">Precio</label>
                            <input type="number" id="productPrice" class="form-input" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="productCost">Costo</label>
                            <input type="number" id="productCost" class="form-input" step="0.01" min="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="productCategory">Categor√≠a</label>
                        <select id="productCategory" class="form-select" required>
                            <option value="">Seleccionar categor√≠a</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDescription">Descripci√≥n</label>
                        <textarea id="productDescription" class="form-textarea" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="productAvailable" checked>
                                <span class="checkmark"></span>
                                Disponible para venta
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">Cancelar</button>
                <button type="submit" form="productForm" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/database.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/auth-guard.js"></script>
    <script src="assets/js/configuracion.js"></script>
    
    <script>
        function logout() {
            authGuard.handleLogout();
        }
    </script>
</body>
</html>
