<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Mesas y Ventas</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        button { margin: 5px; padding: 10px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Debug Mesas y Ventas</h1>
    
    <div class="debug-section">
        <h2>Gesti√≥n de Mesas</h2>
        <button onclick="resetTables()">Reset Mesas</button>
        <button onclick="showTables()">Mostrar Mesas</button>
        <button onclick="addTestTable()">Agregar Mesa de Prueba</button>
        <pre id="tablesOutput"></pre>
    </div>
    
    <div class="debug-section">
        <h2>Test Ventas</h2>
        <label>Mesa: </label>
        <select id="testTableSelect">
            <option value="">Seleccionar Mesa</option>
        </select>
        <button onclick="loadTablesInSelect()">Recargar Mesas</button>
        <pre id="salesOutput"></pre>
    </div>

    <script src="assets/js/database.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/auth-guard.js"></script>
    <script>
        let db;
        
        function initDB() {
            db = new Database();
            loadTablesInSelect();
            showTables();
        }

        function resetTables() {
            localStorage.removeItem('pos_tables');
            db = new Database(); // Reinicializar para que cree las mesas por defecto
            showTables();
            loadTablesInSelect();
            updateOutput('salesOutput', 'Mesas reseteadas correctamente');
        }

        function showTables() {
            const tables = db.getTables();
            updateOutput('tablesOutput', `Total mesas: ${tables.length}\n\n${JSON.stringify(tables, null, 2)}`);
        }

        function addTestTable() {
            try {
                const newTable = {
                    numero: 99,
                    capacidad: 4,
                    ubicacion: 'Test',
                    estado: 'libre'
                };
                
                db.addTable(newTable);
                showTables();
                loadTablesInSelect();
                updateOutput('salesOutput', 'Mesa de prueba agregada');
            } catch (error) {
                updateOutput('salesOutput', 'Error: ' + error.message);
            }
        }

        function loadTablesInSelect() {
            const select = document.getElementById('testTableSelect');
            const tables = db.getTables();
            const availableTables = tables.filter(table => table.estado === 'libre');
            
            select.innerHTML = `
                <option value="">Seleccionar Mesa</option>
                ${availableTables.map(table => 
                    `<option value="${table.id}">Mesa ${table.numero} (${table.capacidad} personas)</option>`
                ).join('')}
            `;
            
            updateOutput('salesOutput', `Mesas disponibles cargadas: ${availableTables.length}`);
        }

        function updateOutput(elementId, content) {
            document.getElementById(elementId).textContent = content;
        }

        // Inicializar al cargar
        window.onload = initDB;
    </script>
</body>
</html>
